<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>ITE SoC SDK: test_uart/test_uart.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ITE SoC SDK
   &#160;<span id="projectnumber">2.2.8.</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('test_uart_2test_uart_8c-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">test_uart/test_uart.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>This is an example of how to use the HAL interrupt and UART APIs.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;pthread.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ith_8h.html">ite/ith.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="itp_8h.html">ite/itp.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;openrtos/FreeRTOS.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;openrtos/queue.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define UartCommandLen 6</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define TEST_PORT ITP_DEVICE_UART0</span></div>
<div class="line"><span class="comment">//#define TEST_PORT ITP_DEVICE_UART1</span></div>
<div class="line"><span class="comment">//#define TEST_PORT ITP_DEVICE_UART2</span></div>
<div class="line"><span class="comment">//#define TEST_PORT ITP_DEVICE_UART3</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> sem_t UartSem;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> UartCallback(<span class="keywordtype">void</span>* arg1, uint32_t arg2)</div>
<div class="line">{</div>
<div class="line">        uint8_t getstr1[256];</div>
<div class="line">        uint8_t sendtr1[8] = {0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A};</div>
<div class="line">        <span class="keywordtype">int</span> len = 0;</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">int</span> totalcount =0;       </div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if 1  // Turn on  ITP_IOCTL_REG_UART_CB  flag , should using these codes.</span></div>
<div class="line">        sem_post(&amp;UartSem);</div>
<div class="line"><span class="preprocessor">#else  // Turn on ITP_IOCTL_REG_UART_DEFER_CB flag , should using these codes.</span></div>
<div class="line">        len = read(TEST_PORT,getstr1+totalcount,256);</div>
<div class="line">        totalcount += len;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span>(totalcount &gt;= UartCommandLen)</div>
<div class="line">        {         </div>
<div class="line">                write(TEST_PORT,sendtr1, 8);</div>
<div class="line">                totalcount =0;</div>
<div class="line">                memset(getstr1, 0, 256);</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> timer_isr(<span class="keywordtype">void</span>* <a name="a0"></a><a class="code" href="test__mqueue_8c.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>)</div>
<div class="line">{</div>
<div class="line">    uint32_t timer = (uint32_t)data;</div>
<div class="line">        </div>
<div class="line">    <a name="a1"></a><a class="code" href="ith_8h.html#a2208c35ecb9e375c7213044d81bba252">ithTimerClearIntr</a>(timer);</div>
<div class="line">        sem_post(&amp;UartSem);</div>
<div class="line">        </div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> UartIntrHandler(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pin, <span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="ith_8h.html#abcb50c9a0a8cfa1f9b1c686d44709b32">ITHTimer</a> timer = (<a name="a2"></a><a class="code" href="ith_8h.html#abcb50c9a0a8cfa1f9b1c686d44709b32">ITHTimer</a>)arg;</div>
<div class="line">        <span class="comment">//ithPrintf(&quot;timer=%d\n&quot;, timer);</span></div>
<div class="line">        <a name="a3"></a><a class="code" href="group__ith__gpio.html#ga9ca8596b6822e22b8114541784b1734b">ithGpioClearIntr</a>(pin);</div>
<div class="line">        <a name="a4"></a><a class="code" href="ith_8h.html#a68c74a580748ae510adb60fc76c6298c">ithTimerCtrlDisable</a>(timer, <a name="a5"></a><a class="code" href="ith_8h.html#ad8c1c52cd8b7de5671cd54ff1c47428ca665051ce49db68ff9723ef3223023262">ITH_TIMER_EN</a>);       </div>
<div class="line">        <a name="a6"></a><a class="code" href="ith_8h.html#af20d4f856c749135affa1c27deb92b8c">ithTimerSetTimeout</a>(timer, 1000);<span class="comment">//us</span></div>
<div class="line">        <a name="a7"></a><a class="code" href="ith_8h.html#abf5b6797572aada72b9acbf351b7b3fa">ithTimerCtrlEnable</a>(timer, <a class="code" href="ith_8h.html#ad8c1c52cd8b7de5671cd54ff1c47428ca665051ce49db68ff9723ef3223023262">ITH_TIMER_EN</a>);        </div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">static void UartIntrHandler2(void * arg)</span></div>
<div class="line"><span class="comment">{</span></div>
<div class="line"><span class="comment">        ITHUartPort port = (ITHUartPort)arg;</span></div>
<div class="line"><span class="comment">        ithUartClearIntr(port);</span></div>
<div class="line"><span class="comment">        ithPrintf(&quot;-- uart handle2 --\n&quot;);</span></div>
<div class="line"><span class="comment">}*/</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> InitUartIntr(<a class="code" href="group__ith__uart.html#gad172db2bc4ba16065cb996bc5272e6a0">ITHUartPort</a> port)</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">        <a name="a8"></a><a class="code" href="group__ith__platform.html#gadfb5200d35b0c4754769b3b63f62699c">ithEnterCritical</a>();</div>
<div class="line"><span class="preprocessor">#if 1</span></div>
<div class="line">    <a class="code" href="group__ith__gpio.html#ga9ca8596b6822e22b8114541784b1734b">ithGpioClearIntr</a>(CFG_GPIO_UART0_RX);</div>
<div class="line">    <a name="a9"></a><a class="code" href="group__ith__gpio.html#gab7ad3e1ddc024698ddf8f429a2d2d0e8">ithGpioSetIn</a>(CFG_GPIO_UART0_RX);</div>
<div class="line">    <a name="a10"></a><a class="code" href="group__ith__gpio.html#ga901b6529010db45f05669bd7a5280ad4">ithGpioRegisterIntrHandler</a>(CFG_GPIO_UART0_RX, UartIntrHandler, <a name="a11"></a><a class="code" href="ith_8h.html#abcb50c9a0a8cfa1f9b1c686d44709b32a8192461a6a1468b5cf856d5d0bfdbb1b">ITH_TIMER5</a>);</div>
<div class="line">        </div>
<div class="line">    <a name="a12"></a><a class="code" href="group__ith__gpio.html#gaa6d6528d95224e17ecbeb2e84ab2b101">ithGpioCtrlDisable</a>(CFG_GPIO_UART0_RX, <a name="a13"></a><a class="code" href="group__ith__gpio.html#ggac9bbaae3f1a8537a94fcedf62762634aa553e7af2469950f21dd92911774c51eb">ITH_GPIO_INTR_LEVELTRIGGER</a>);   <span class="comment">/* use edge trigger mode */</span></div>
<div class="line">    <a name="a14"></a><a class="code" href="group__ith__gpio.html#gaaa64baec11dbcfa33fea545b6c72f604">ithGpioCtrlEnable</a>(CFG_GPIO_UART0_RX, <a name="a15"></a><a class="code" href="group__ith__gpio.html#ggac9bbaae3f1a8537a94fcedf62762634aab049b77407f975b0bda8f00a7bbfd4fd">ITH_GPIO_INTR_BOTHEDGE</a>); <span class="comment">/* both edge */</span>    </div>
<div class="line">    <a name="a16"></a><a class="code" href="group__ith.html#ga2da831d2ee918e0613d9515635cec4e7">ithIntrEnableIrq</a>(<a name="a17"></a><a class="code" href="group__ith.html#gga0e5b9e1460a1a9e46bf53840928dfca9a27b3916a6787bdd1cc9c0cd67d029dfd">ITH_INTR_GPIO</a>);</div>
<div class="line">    <a name="a18"></a><a class="code" href="group__ith__gpio.html#ga55a644b8476e9a6f94352835876582c2">ithGpioEnableIntr</a>(CFG_GPIO_UART0_RX);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">        <span class="comment">//printf(&quot;port = 0x%x\n&quot;, port);</span></div>
<div class="line">        <a name="a19"></a><a class="code" href="group__ith.html#gadf6f0b751adf28d55306cdb1b5bedef0">ithIntrDisableIrq</a>(<a name="a20"></a><a class="code" href="group__ith.html#gga0e5b9e1460a1a9e46bf53840928dfca9ac8751ea106a8176024d9eb6cf6b6dbbc">ITH_INTR_UART0</a>);</div>
<div class="line">    <a name="a21"></a><a class="code" href="group__ith__uart.html#gabe706b2ec55e097a0e18016e6bdaf7fd">ithUartClearIntr</a>(<a name="a22"></a><a class="code" href="group__ith__uart.html#ggad172db2bc4ba16065cb996bc5272e6a0a336cb532484ee11921cbf733720cb625">ITH_UART0</a>);</div>
<div class="line">    <a name="a23"></a><a class="code" href="group__ith.html#gafe672c01cd8c493a8f1b973a18805e2a">ithIntrClearIrq</a>(<a class="code" href="group__ith.html#gga0e5b9e1460a1a9e46bf53840928dfca9ac8751ea106a8176024d9eb6cf6b6dbbc">ITH_INTR_UART0</a>);</div>
<div class="line"></div>
<div class="line">    <a name="a24"></a><a class="code" href="group__ith.html#ga81de644c382cf73c912bfd6eb2e4c7d5">ithIntrSetTriggerModeIrq</a>(<a class="code" href="group__ith.html#gga0e5b9e1460a1a9e46bf53840928dfca9ac8751ea106a8176024d9eb6cf6b6dbbc">ITH_INTR_UART0</a>, <a name="a25"></a><a class="code" href="group__ith.html#gga04fd4ddfb377b4fc7e09395f38b03fc5a683a3eb975ecc24c6ca88f644d7a23cc">ITH_INTR_LEVEL</a>);</div>
<div class="line">    <a name="a26"></a><a class="code" href="group__ith.html#gaf687ad23ab8c7f857671501c43323655">ithIntrRegisterHandlerIrq</a>(<a class="code" href="group__ith.html#gga0e5b9e1460a1a9e46bf53840928dfca9ac8751ea106a8176024d9eb6cf6b6dbbc">ITH_INTR_UART0</a>, UartIntrHandler2, (<span class="keywordtype">void</span> *)<a class="code" href="group__ith__uart.html#ggad172db2bc4ba16065cb996bc5272e6a0a336cb532484ee11921cbf733720cb625">ITH_UART0</a>);</div>
<div class="line">    <a name="a27"></a><a class="code" href="group__ith__uart.html#ga2f21184d9bc0a2c3d8d440f7986c7238">ithUartEnableIntr</a>(<a class="code" href="group__ith__uart.html#ggad172db2bc4ba16065cb996bc5272e6a0a336cb532484ee11921cbf733720cb625">ITH_UART0</a>, <a name="a28"></a><a class="code" href="group__ith__uart.html#gga64f0e0aad6323ae90f30e432f5a8dcaaa826941a40a7110367fb6b7e5b3037d68">ITH_UART_RX_READY</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Enable the interrupts. */</span></div>
<div class="line">    <a class="code" href="group__ith.html#ga2da831d2ee918e0613d9515635cec4e7">ithIntrEnableIrq</a>(<a class="code" href="group__ith.html#gga0e5b9e1460a1a9e46bf53840928dfca9ac8751ea106a8176024d9eb6cf6b6dbbc">ITH_INTR_UART0</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <a name="a29"></a><a class="code" href="group__ith__platform.html#gad1a44ede677cdd5737b40dd53d9b206d">ithExitCritical</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> InitTimer(<a class="code" href="ith_8h.html#abcb50c9a0a8cfa1f9b1c686d44709b32">ITHTimer</a> timer, <a class="code" href="group__ith.html#ga0e5b9e1460a1a9e46bf53840928dfca9">ITHIntr</a> intr)</div>
<div class="line">{</div>
<div class="line">        </div>
<div class="line">        <a name="a30"></a><a class="code" href="ith_8h.html#afedb49b615dc3d583b59230619ebf318">ithTimerReset</a>(timer);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Initialize Timer IRQ</span></div>
<div class="line">        <a class="code" href="group__ith.html#gadf6f0b751adf28d55306cdb1b5bedef0">ithIntrDisableIrq</a>(intr);</div>
<div class="line">        <a class="code" href="group__ith.html#gafe672c01cd8c493a8f1b973a18805e2a">ithIntrClearIrq</a>(intr);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// register Timer Handler to IRQ</span></div>
<div class="line">        <a class="code" href="group__ith.html#gaf687ad23ab8c7f857671501c43323655">ithIntrRegisterHandlerIrq</a>(intr, timer_isr, (<span class="keywordtype">void</span>*)timer);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// set Timer IRQ to edge trigger</span></div>
<div class="line">        <a class="code" href="group__ith.html#ga81de644c382cf73c912bfd6eb2e4c7d5">ithIntrSetTriggerModeIrq</a>(intr, <a name="a31"></a><a class="code" href="group__ith.html#gga04fd4ddfb377b4fc7e09395f38b03fc5a1dc698aa92d3c36e810ac1bbd2cce192">ITH_INTR_EDGE</a>);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// set Timer IRQ to detect rising edge</span></div>
<div class="line">        <a name="a32"></a><a class="code" href="group__ith.html#ga4b599ad44b64f934546008a4793f377f">ithIntrSetTriggerLevelIrq</a>(intr, <a name="a33"></a><a class="code" href="group__ith.html#gga5b738067c5a7f4cc4debe9171a5c3bd0a2e56e9f20850dbf7e6f04987db5d9eb3">ITH_INTR_HIGH_RISING</a>);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Enable Timer IRQ</span></div>
<div class="line">        <a class="code" href="group__ith.html#ga2da831d2ee918e0613d9515635cec4e7">ithIntrEnableIrq</a>(intr);</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span>* TestFuncUseDMA(<span class="keywordtype">void</span>* arg)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> len = 0;</div>
<div class="line">        <span class="keywordtype">int</span> count = 0;</div>
<div class="line">        <span class="keywordtype">char</span> getstr[256];</div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line">        <a name="a34"></a><a class="code" href="group__itp__device.html#ga7c6f6de5f8df7618abdde7bab7cb779b">itpRegisterDevice</a>(TEST_PORT, &amp;<a name="a35"></a><a class="code" href="group__itp__device.html#ga164ecb9023d3a215e29cbdc1dc2b4b13">itpDeviceUart0</a>);</div>
<div class="line">        ioctl(TEST_PORT, <a name="a36"></a><a class="code" href="group__itp__device.html#gabed8845032f5bf82857b4297bcadcba3">ITP_IOCTL_RESET</a>, CFG_UART0_BAUDRATE);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Start uart DMA test!\n&quot;</span>);</div>
<div class="line">        InitTimer(<a class="code" href="ith_8h.html#abcb50c9a0a8cfa1f9b1c686d44709b32a8192461a6a1468b5cf856d5d0bfdbb1b">ITH_TIMER5</a>, <a name="a37"></a><a class="code" href="group__ith.html#gga0e5b9e1460a1a9e46bf53840928dfca9aafc4265a1fa66c74a7bec1f321ed3c93">ITH_INTR_TIMER5</a>);</div>
<div class="line">        InitUartIntr(TEST_PORT);</div>
<div class="line">        memset(getstr, 0, 256);</div>
<div class="line">        sem_init(&amp;UartSem, 0, 0);</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">while</span>(1)</div>
<div class="line">        {</div>
<div class="line">                sem_wait(&amp;UartSem);</div>
<div class="line">                </div>
<div class="line">                len = read(TEST_PORT, getstr+count, 256);</div>
<div class="line">                printf(<span class="stringliteral">&quot;len = %d\n&quot;</span>, len);</div>
<div class="line">            count += len;</div>
<div class="line">            <span class="keywordflow">if</span>(count &gt;= UartCommandLen)</div>
<div class="line">            {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;uart read: %s,count=%d\n&quot;</span>,getstr,count);</div>
<div class="line">                    count =0;</div>
<div class="line">                    memset(getstr, 0, 256);             </div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span>* <a name="a38"></a><a class="code" href="test__pthread__attr_8c.html#a95e5902af43e72ac2e4dfa307484f40a">TestFunc</a>(<span class="keywordtype">void</span>* arg)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> <a name="a39"></a><a class="code" href="test__sched_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line">    <span class="keywordtype">char</span> getstr[256];</div>
<div class="line">    <span class="keywordtype">char</span> sendtr[256];</div>
<div class="line">        <span class="keywordtype">int</span> len = 0;</div>
<div class="line">        <span class="keywordtype">int</span> count =0;</div>
<div class="line"></div>
<div class="line">        printf(<span class="stringliteral">&quot;Start uart test!\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">        sem_init(&amp;UartSem, 0, 0);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__itp__device.html#ga7c6f6de5f8df7618abdde7bab7cb779b">itpRegisterDevice</a>(TEST_PORT, &amp;<a class="code" href="group__itp__device.html#ga164ecb9023d3a215e29cbdc1dc2b4b13">itpDeviceUart0</a>);</div>
<div class="line">    ioctl(TEST_PORT, <a name="a40"></a><a class="code" href="group__itp__device.html#gad6e33b5b8de394f1bbe1f1eb5a634128">ITP_IOCTL_INIT</a>, NULL);</div>
<div class="line"><span class="preprocessor">#ifdef CFG_UART0_ENABLE</span></div>
<div class="line">    ioctl(TEST_PORT, <a class="code" href="group__itp__device.html#gabed8845032f5bf82857b4297bcadcba3">ITP_IOCTL_RESET</a>, CFG_UART0_BAUDRATE);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        ioctl(TEST_PORT, <a name="a41"></a><a class="code" href="group__itp__device.html#gaab550b50d445036705d9682a89d6b8d0">ITP_IOCTL_REG_UART_CB</a>, (<span class="keywordtype">void</span>*)UartCallback);</div>
<div class="line">        <span class="comment">//ioctl(TEST_PORT, ITP_IOCTL_REG_UART_DEFER_CB , (void*)UartCallback);</span></div>
<div class="line"></div>
<div class="line">        memset(getstr, 0, 256);</div>
<div class="line">        memset(sendtr, 0, 256);</div>
<div class="line">        </div>
<div class="line">    <span class="keywordflow">while</span>(1)</div>
<div class="line">    {</div>
<div class="line">        sem_wait(&amp;UartSem);</div>
<div class="line">            len = read(TEST_PORT,getstr+count,256);</div>
<div class="line">            count += len;</div>
<div class="line">                 </div>
<div class="line">            <span class="keywordflow">if</span>(count &gt;= UartCommandLen)</div>
<div class="line">            {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;uart read: %s,count=%d\n&quot;</span>,getstr,count);</div>
<div class="line">                    count =0;</div>
<div class="line">                    sprintf(sendtr,<span class="stringliteral">&quot;%s\n&quot;</span>,getstr);                </div>
<div class="line">            write(TEST_PORT, sendtr, 256);      </div>
<div class="line">                    memset(getstr, 0, 256);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Nov 6 2017 20:07:26 for ITE SoC SDK by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
